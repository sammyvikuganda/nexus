<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <title>Navigation Example</title>
    
    <!-- Theme initialization script - runs immediately -->
    <script>
        // Check for saved theme preference immediately
        (function() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.documentElement.classList.add('dark-theme');
            }
        })();
    </script>

    <style>
        /* My CSS*/
    </style>
</head>
<body>
    <div id="content"></div>
    <div class="bottom-nav">
        <div class="nav-items-wrapper">
            <div class="nav-item home inactive">
                <i class="fas fa-home"></i>
                <p>Home</p>
            </div>
            <div class="nav-item chat inactive">
                <i class="fas fa-headset"></i>
                <p>Support</p>
            </div>
            <div class="nav-item wallet inactive">
                <i class="fas fa-store"></i>
                <p>Store</p>
            </div>
            <div class="nav-item reports inactive">
                <i class="fas fa-piggy-bank"></i>
                <p>Saving</p>
            </div>
            <div class="nav-item settings inactive">
                <i class="fas fa-compass"></i>
                <p>Explore</p>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-database.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-analytics.js";

        const firebaseConfig = {
            apiKey: "AIzaSyChlMYXcLFlfRsX3UARcoK8-IC8XRxig14",
            authDomain: "records-1674c.firebaseapp.com",
            databaseURL: "https://records-1674c-default-rtdb.firebaseio.com",
            projectId: "records-1674c",
            storageBucket: "records-1674c.appspot.com",
            messagingSenderId: "592414404602",
            appId: "1:592414404602:web:917365f2b54522ef953e43",
            measurementId: "G-H6HCSQWZY2"
        };

        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const database = getDatabase(app);

        const host = window.location.origin;
        const serverUrl = host;
        const balanceServerUrl = host;
        const capitalServerUrl = host;
        const BASE_URL = host;

        let progressInterval = null;
        let countdownInterval = null;
        let currentAction = null;
        let stopInvestmentAmount = 0; // Store amount for use in modal confirmation
        let userId = null; // Will be set after session check

        // Function to handle the active state
        function setActive(navItem) {
            const allNavItems = document.querySelectorAll('.nav-item');
            allNavItems.forEach(item => {
                item.classList.remove('active');
                item.classList.add('inactive');
            });

            navItem.classList.remove('inactive');
            navItem.classList.add('active');
        }

        // Theme toggle functionality
        function toggleTheme() {
            document.documentElement.classList.toggle('dark-theme');
            const isDark = document.documentElement.classList.contains('dark-theme');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            
            // Update the toggle switch
            const themeToggle = document.getElementById('homeThemeToggle');
            if (themeToggle) {
                themeToggle.checked = isDark;
            }
        }

        function loadHomeContent() {
            const isDark = document.documentElement.classList.contains('dark-theme');
            
            const content = `
                <!-- Your home content here -->
            `;
            
            document.getElementById('content').innerHTML = content;
        }

        function goToSupport() {
            const supportContent = `
                <!-- Your support content here -->
            `;
            document.getElementById('content').innerHTML = supportContent;
        }

        function goToWallet() {
            const walletContent = `
                <!-- Your wallet content here -->
            `;
            document.getElementById('content').innerHTML = walletContent;
        }

        function goToReports() {
            const reportsContent = `
                <!-- Your reports content here -->
            `;
            document.getElementById('content').innerHTML = reportsContent;
        }

        function goToSettings() {
            const settingsContent = `
                <!-- Your settings content here -->
            `;
            document.getElementById('content').innerHTML = settingsContent;
        }

        // Check session and initialize app
        function initializeAppWithSession() {
            fetch('/api/session')
                .then(res => {
                    if (!res.ok) {
                        throw new Error('Session check failed');
                    }
                    return res.json();
                })
                .then(data => {
                    if (!data.userId) {
                        // No userId means unauthenticated, redirect to login
                        window.location.href = '/login';
                    } else {
                        userId = data.userId;
                        console.log('Session userId:', userId);
                        
                        // Now that we have userId, we can initialize the app
                        loadHomeContent();
                        setActive(document.querySelector('.nav-item.home'));

                        // Navigation event listeners
                        document.querySelector('.nav-item.home').addEventListener('click', () => {
                            loadHomeContent();
                            setActive(document.querySelector('.nav-item.home'));
                        });

                        document.querySelector('.nav-item.chat').addEventListener('click', () => {
                            goToSupport();
                            setActive(document.querySelector('.nav-item.chat'));
                        });

                        document.querySelector('.nav-item.wallet').addEventListener('click', () => {
                            goToWallet();
                            setActive(document.querySelector('.nav-item.wallet'));
                        });

                        document.querySelector('.nav-item.reports').addEventListener('click', () => {
                            goToReports();
                            setActive(document.querySelector('.nav-item.reports'));
                        });

                        document.querySelector('.nav-item.settings').addEventListener('click', () => {
                            goToSettings();
                            setActive(document.querySelector('.nav-item.settings'));
                        });
                    }
                })
                .catch(err => {
                    console.error('Session fetch error:', err);
                    window.location.href = '/login';
                });
        }

        document.addEventListener('DOMContentLoaded', initializeAppWithSession);
    </script>
</body>
</html>
