<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg-light: #f8fafc;
            --card-light: #ffffff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --accent-blue: #2563eb;
            --accent-green: #10b981;
            --accent-yellow: #f59e0b;
            --accent-red: #ef4444;
            --border-radius: 12px;
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            
            --bg-dark: #0f172a;
            --card-dark: #1e293b;
            --text-primary-dark: #e2e8f0;
            --text-secondary-dark: #94a3b8;

            --bg: var(--bg-light);
            --card: var(--card-light);
            --text-main: var(--text-primary);
            --text-sub: var(--text-secondary);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text-main);
            line-height: 1.4;
            font-size: 14px;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        .profile-header {
            padding: 1.2rem;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            transition: background-color 0.3s ease;
        }
        
        .profile-main {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .profile-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--bg);
        }
        
        .profile-name {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.3rem;
        }
        
        .kyc-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.3rem 0.7rem;
            background-color: rgba(16, 185, 129, 0.1);
            color: var(--accent-green);
            border-radius: 50px;
            font-size: 0.7rem;
            font-weight: 500;
        }
        
        .contact-info {
            padding: 1rem;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            transition: background-color 0.3s ease;
        }
        
        .contact-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 0.8rem;
        }
        
        .contact-item {
            display: flex;
            align-items: center;
            gap: 0.6rem;
            font-size: 0.9rem;
            color: var(--text-main);
        }
        
        .contact-icon {
            color: var(--accent-blue);
            width: 16px;
            text-align: center;
            font-size: 0.9rem;
        }
        
        .personal-info {
            padding: 1.2rem;
            margin-bottom: 1rem;
            transition: background-color 0.3s ease;
        }
        
        .section-title {
            font-size: 0.95rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--accent-blue);
            display: flex;
            align-items: center;
            gap: 0.6rem;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 1rem;
        }
        
        .info-item {
            display: flex;
            flex-direction: column;
        }
        
        .info-label {
            font-size: 0.7rem;
            color: var(--text-sub);
            margin-bottom: 0.2rem;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            transition: color 0.3s ease;
        }
        
        .info-value {
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        .settings-btn {
            display: block;
            width: calc(100% - 2.4rem);
            margin: 0 1.2rem 1.2rem;
            padding: 0.7rem;
            background: var(--card);
            color: var(--accent-blue);
            border: 1px solid rgba(0,0,0,0.1);
            border-radius: var(--border-radius);
            font-weight: 500;
            font-size: 0.9rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .settings-btn:hover {
            background: var(--accent-blue);
            color: white;
            border-color: var(--accent-blue);
        }
        
        .settings-btn i {
            margin-right: 0.5rem;
        }
        
        @media (max-width: 600px) {
            .profile-main {
                flex-direction: column;
                text-align: center;
                gap: 0.8rem;
            }
            
            .contact-grid, .info-grid {
                grid-template-columns: 1fr;
            }
        }

        body.dark-theme {
            --bg: var(--bg-dark);
            --card: var(--card-dark);
            --text-main: var(--text-primary-dark);
            --text-sub: var(--text-secondary-dark);
        }

        /* Skeleton Loading Styles */
        .skeleton {
            background-color: #e2e8f0;
            background-image: linear-gradient(
                90deg,
                rgba(255, 255, 255, 0),
                rgba(255, 255, 255, 0.3),
                rgba(255, 255, 255, 0)
            );
            background-size: 200px 100%;
            background-repeat: no-repeat;
            border-radius: 4px;
            display: inline-block;
            line-height: 1;
            animation: shimmer 1.5s infinite linear;
        }

        .skeleton-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
        }

        .skeleton-text {
            height: 12px;
            width: 100px;
        }

        .skeleton-text-sm {
            height: 10px;
            width: 60px;
        }

        .skeleton-badge {
            height: 20px;
            width: 80px;
            border-radius: 50px;
        }

        .skeleton-icon {
            width: 16px;
            height: 16px;
            border-radius: 50%;
        }

        .skeleton-item {
            height: 16px;
            width: 120px;
        }

        @keyframes shimmer {
            0% {
                background-position: -200px 0;
            }
            100% {
                background-position: 200px 0;
            }
        }

        #profileContent {
            display: none;
        }

        #skeletonLoading {
            padding: 1.2rem;
        }

        body.dark-theme .skeleton {
            background-color: #334155;
            background-image: linear-gradient(
                90deg,
                rgba(255, 255, 255, 0),
                rgba(255, 255, 255, 0.1),
                rgba(255, 255, 255, 0)
            );
        }
    </style>
</head>
<body>
    <!-- Skeleton Loading -->
    <div id="skeletonLoading">
        <div class="profile-header">
            <div class="profile-main">
                <div class="skeleton skeleton-avatar"></div>
                <div style="flex: 1;">
                    <div class="skeleton skeleton-text" style="width: 150px; margin-bottom: 0.5rem;"></div>
                    <div class="skeleton skeleton-badge"></div>
                </div>
            </div>
        </div>
        
        <div class="contact-info">
            <div class="contact-grid">
                <div class="contact-item">
                    <div class="skeleton skeleton-icon"></div>
                    <div class="skeleton skeleton-item"></div>
                </div>
                
                <div class="contact-item">
                    <div class="skeleton skeleton-icon"></div>
                    <div class="skeleton skeleton-item"></div>
                </div>
                
                <div class="contact-item">
                    <div class="skeleton skeleton-icon"></div>
                    <div class="skeleton skeleton-item"></div>
                </div>
            </div>
        </div>
        
        <div class="personal-info">
            <div class="skeleton skeleton-text" style="width: 120px; margin-bottom: 1rem;"></div>
            
            <div class="info-grid">
                <div class="info-item">
                    <div class="skeleton skeleton-text-sm" style="margin-bottom: 0.5rem;"></div>
                    <div class="skeleton skeleton-text"></div>
                </div>
                
                <div class="info-item">
                    <div class="skeleton skeleton-text-sm" style="margin-bottom: 0.5rem;"></div>
                    <div class="skeleton skeleton-text"></div>
                </div>
                
                <div class="info-item">
                    <div class="skeleton skeleton-text-sm" style="margin-bottom: 0.5rem;"></div>
                    <div class="skeleton skeleton-text"></div>
                </div>
            </div>
        </div>

        <div class="skeleton" style="width: calc(100% - 2.4rem); margin: 0 1.2rem 1.2rem; padding: 0.7rem; border-radius: var(--border-radius);"></div>
    </div>

    <!-- Actual Profile Content -->
    <div id="profileContent">
        <div class="profile-header">
            <div class="profile-main">
                <img src="https://i.postimg.cc/KvWfCL0S/9187604.png" alt="Profile Photo" class="profile-avatar">
                <div>
                    <h1 class="profile-name" id="fullName">Loading...</h1>
                    <span class="kyc-badge" id="kycBadge">
                        <i class="fas fa-check-circle"></i>
                        KYC Verified
                    </span>
                </div>
            </div>
        </div>
        
        <div class="contact-info">
            <div class="contact-grid">
                <div class="contact-item">
                    <div class="contact-icon">
                        <i class="fas fa-envelope"></i>
                    </div>
                    <div id="userEmail">Loading...</div>
                </div>
                
                <div class="contact-item">
                    <div class="contact-icon">
                        <i class="fas fa-phone"></i>
                    </div>
                    <div id="userPhone">Loading...</div>
                </div>
                
                <div class="contact-item">
                    <div class="contact-icon">
                        <i class="fas fa-id-card"></i>
                    </div>
                    <div id="userId">Loading...</div>
                </div>
            </div>
        </div>
        
        <div class="personal-info">
            <h2 class="section-title">
                <i class="fas fa-user"></i>
                Account Details
            </h2>
            
            <div class="info-grid">
                <div class="info-item">
                    <div class="info-label">Full Name</div>
                    <div class="info-value" id="fullNameDetail">Loading...</div>
                </div>
                
                <div class="info-item">
                    <div class="info-label">Registered At</div>
                    <div class="info-value" id="registeredAt">Loading...</div>
                </div>
                
                <div class="info-item">
                    <div class="info-label">Nationality</div>
                    <div class="info-value" id="country">Loading...</div>
                </div>
            </div>
        </div>

        <button class="settings-btn" onclick="window.location.href='/user-setting'">
    <i class="fas fa-cog"></i> Settings
</button>

    </div>

    <!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
    // Apply saved theme on load
    function applySavedTheme() {
        const body = document.body;
        const savedTheme = localStorage.getItem('theme');

        if (!savedTheme) {
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            if (prefersDark) {
                body.classList.add('dark-theme');
            }
        } else if (savedTheme === 'dark') {
            body.classList.add('dark-theme');
        }
    }

    // Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyChlMYXcLFlfRsX3UARcoK8-IC8XRxig14",
        authDomain: "records-1674c.firebaseapp.com",
        databaseURL: "https://records-1674c-default-rtdb.firebaseio.com",
        projectId: "records-1674c",
        storageBucket: "records-1674c.appspot.com",
        messagingSenderId: "592414404602",
        appId: "1:592414404602:web:917365f2b54522ef953e43",
        measurementId: "G-H6HCSQWZY2"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // Fetch user data from Firebase
    function fetchUserData(userId) {
        const dbRef = firebase.database().ref(`users/${userId}`);
        dbRef.once('value')
            .then((snapshot) => {
                const userData = snapshot.val();

                if (userData) {
                    document.getElementById('fullName').textContent = `${userData.firstName || ''} ${userData.lastName || ''}`.trim();
                    document.getElementById('fullNameDetail').textContent = `${userData.firstName || ''} ${userData.lastName || ''}`.trim();
                    document.getElementById('userEmail').textContent = userData.email || 'Not provided';
                    document.getElementById('userPhone').textContent = userData.phoneNumber || 'Not provided';
                    document.getElementById('userId').textContent = `User ID: ${userId}`;
                    document.getElementById('country').textContent = userData.country || 'Not provided';

                    if (userData.registeredAt) {
                        const regDate = new Date(userData.registeredAt);
                        document.getElementById('registeredAt').textContent = regDate.toLocaleDateString('en-US', {
                            year: 'numeric',
                            month: 'long',
                            day: 'numeric'
                        });
                    }

                    const kycBadge = document.getElementById('kycBadge');
                    if (userData.kyc === true || userData.kyc === 'verified') {
                        kycBadge.innerHTML = '<i class="fas fa-check-circle"></i> KYC Verified';
                        kycBadge.style.backgroundColor = 'rgba(16, 185, 129, 0.1)';
                        kycBadge.style.color = 'var(--accent-green)';
                    } else {
                        kycBadge.innerHTML = '<i class="fas fa-times-circle"></i> KYC Not Verified';
                        kycBadge.style.backgroundColor = 'rgba(239, 68, 68, 0.1)';
                        kycBadge.style.color = 'var(--accent-red)';
                    }

                    document.getElementById('skeletonLoading').style.display = 'none';
                    document.getElementById('profileContent').style.display = 'block';
                } else {
                    console.error("No user data found for ID:", userId);
                }
            })
            .catch((error) => {
                console.error("Error fetching user data:", error);
            });
    }

    // On DOM load
    window.addEventListener('DOMContentLoaded', () => {
        applySavedTheme();

        // Fetch user session
        fetch('/api/session')
            .then(res => res.json())
            .then(data => {
                if (!data.userId) {
                    window.location.href = '/api/login';
                } else {
                    const userId = data.userId;
                    console.log('Session userId:', userId);
                    fetchUserData(userId);
                }
            })
            .catch(err => {
                console.error('Session fetch error:', err);
                window.location.href = '/login';
            });
    });
</script>

</body>
</html>
